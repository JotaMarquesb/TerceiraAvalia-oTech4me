unit uDM;

interface

uses
  System.SysUtils, System.Classes, uBancoController, uContaBancaria;

type
  TDM = class(TDataModule)
  public
    Banco: TBancoController;
    constructor Create(AOwner: TComponent); override;
    destructor Destroy; override;
  end;

var
  DM: TDM;

implementation

{%CLASSGROUP 'Vcl.Controls.TControl'}

{$R *.dfm}

constructor TDM.Create(AOwner: TComponent);
begin
  inherited;
  Banco := TBancoController.Create;
end;

destructor TDM.Destroy;
begin
  Banco.Free;
  inherited;
end;

function TBanco.ExisteCPF(const ACPF: string): Boolean;
var
  Conta: TContaBancaria;
begin
  Result := False;

  for Conta in FContas do
  begin
    if Conta.CPF = ACPF then
      Exit(True);
  end;
end;

function TBanco.CriarConta(const ATitular, ACPF: string): TContaBancaria;
begin
  if ExisteCPF(ACPF) then
    raise Exception.Create('CPF já cadastrado!');

  Inc(FUltimoNumero);

  Result := TContaBancaria.Create;
  Result.FTitular := ATitular;
  Result.FCPF := ACPF;
  Result.FNumeroConta := FormatFloat('0000', FUltimoNumero);
  Result.FSaldo := 0;

  FContas.Add(Result);
end;

end.
